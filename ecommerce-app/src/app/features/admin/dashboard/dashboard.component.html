<div class="container mx-auto px-4 py-8">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
    <div>
      <h1 class="text-3xl font-bold">Inventario</h1>
      <p class="text-base-content/60">Gestiona tus productos y stock</p>
    </div>
    <a routerLink="/admin/create-product" class="btn btn-primary gap-2">
      <i class="bi bi-plus-lg"></i> Nuevo Producto
    </a>
  </div>

  <!-- Loader -->
  <app-loader [isLoading]="isLoading" message="Cargando inventario..."></app-loader>

  <!-- Error -->
  @if (errorMessage) {
    <div class="alert alert-error shadow-lg">
      <i class="bi bi-x-circle"></i>
      <span>{{ errorMessage }}</span>
    </div>
  }

  <!-- Tabla -->
  @if (!isLoading && !errorMessage) {
    <div class="overflow-x-auto w-full bg-base-100 shadow-xl rounded-box">
      <table class="table w-full">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Categoría / Marca</th>
            <th>Precio</th>
            <th>Stock</th>
            <th>Estado</th>
            <th>Destacado</th>
            <th class="text-right">Acciones</th>
          </tr>
        </thead>

        <tbody>
          @for (product of products; track product._id) {
            <tr class="hover">
              <!-- Producto -->
              <td>
                <div class="flex items-center space-x-3">
                  <div class="avatar">
                    <div class="mask mask-squircle w-12 h-12 bg-base-200">
                      <img [src]="product.images[0]" appImgFallback [alt]="product.name" />
                    </div>
                  </div>
                  <div>
                    <div class="font-bold line-clamp-1 max-w-[200px]">
                      {{ product.name }}
                    </div>
                    <div class="text-xs opacity-50">
                      ID: {{ product._id | slice:0:8 }}...
                    </div>
                  </div>
                </div>
              </td>

              <!-- Categoría / Marca -->
              <td>
                <div class="badge badge-ghost">{{ product.brand }}</div>
              </td>

              <!-- Precio -->
              <td class="font-bold font-mono text-primary">
                ${{ product.price }}
              </td>

              <!-- Stock -->
              <td>
                @if (product.stock === 0) {
                  <span class="text-error font-bold flex items-center gap-1">
                    <i class="bi bi-exclamation-circle-fill"></i> 0
                  </span>
                } @else if ((product.stock || 0) < 5) {
                  <span class="text-warning font-bold">
                    {{ product.stock }} (Bajo)
                  </span>
                } @else {
                  <span class="text-success font-bold">
                    {{ product.stock }}
                  </span>
                }
              </td>

              <!-- Estado Activo/Inactivo -->
              <td>
                @if (product.isActive) {
                  <div class="badge badge-success gap-1 text-white">Activo</div>
                } @else {
                  <div class="badge badge-ghost gap-1">Inactivo</div>
                }
              </td>

              <!-- Destacado -->
              <td>
                <button
                  type="button"
                  class="btn btn-xs"
                  [ngClass]="product.isFeatured ? 'btn-success text-white' : 'btn-ghost'"
                  (click)="toggleFeatured(product)"
                >
                  {{ product.isFeatured ? 'Sí' : 'No' }}
                </button>
              </td>

              <!-- Acciones -->
              <th class="text-right">
                <div class="join">
                  <a
                    [routerLink]="['/admin/edit-product', product._id]"
                    class="btn btn-sm btn-ghost join-item text-info"
                    title="Editar"
                  >
                    <i class="bi bi-pencil-square text-lg"></i>
                  </a>
                  <button
                    (click)="deleteProduct(product._id)"
                    class="btn btn-sm btn-ghost join-item text-error"
                    title="Eliminar"
                  >
                    <i class="bi bi-trash text-lg"></i>
                  </button>
                </div>
              </th>
            </tr>
          }
        </tbody>

        <tfoot>
          <tr>
            <td colspan="7" class="text-center text-xs opacity-50">
              Mostrando {{ products.length }} productos
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
  }
</div>
